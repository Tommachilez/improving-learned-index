# Doc2Query--

## Relevant papers

- Rodrigo Nogueira, Wei Yang, Jimmy Lin, and Kyunghyun Cho. 2019. _Document Expansion by Query Prediction_. arXiv:1904.08375 [cs.IR] ([paper](https://arxiv.org/pdf/1904.08375.pdf))
- Rodrigo Nogueira and Jimmy Lin. 2019. _From doc2query to docTTTTTquery_ ([paper](https://cs.uwaterloo.ca/~jimmylin/publications/Nogueira_Lin_2019_docTTTTTquery-v2.pdf))
- Mitko Gospodinov, Sean MacAvaney, and Craig Macdonald. 2023. _Doc2Query--: When Less is More_. arXiv:2301.03266 [cs.IR] ([paper](https://arxiv.org/pdf/2301.03266.pdf))

## Notes

There is an issue with `pyterrier_doc2query` which prevents downloading and using
the [pre-computed queries generated by docT5query](https://huggingface.co/datasets/macavaney/d2q-msmarco-passage/tree/main)
and
[pre-computed ELECTRA scores](https://huggingface.co/datasets/macavaney/d2q-msmarco-passage-scores-electra/tree/main).

I have opened an issue in their
repo: [Issues with Fetching Queries/Scores from Store #9](https://github.com/terrierteam/pyterrier_doc2query/issues/9)


### Setup

Make sure to have [Git LFS](https://git-lfs.com) installed. For now, I manually introduce the setup of Git LFS to solve
the issue.

Other than that, you can create a new Python virtual environment and install all the dependencies using the requirements
file:

```bash
pip install -r requirements.txt
```

### Data

#### MS MARCO Passage Collections Dataset
You will need the `collections.tsv` file from [MS MARCO Passage Retrieval](https://microsoft.github.io/msmarco/) dataset.

* [Collection(10/26/2018)](https://msmarco.blob.core.windows.net/msmarcoranking/collection.tar.gz)

You can download the file and extract it using:

```bash
tar -xvf collection.tar.gz
```

#### Pre-computed Queries using docT5query Expansion Model
* https://huggingface.co/datasets/macavaney/d2q-msmarco-passage

#### Pre-computed ELECTRA Scores for the Pre-computed Queries
* https://huggingface.co/datasets/macavaney/d2q-msmarco-passage-scores-electra


### Usage

You can call the module directly from the command line using:

```bash
python -m doc2query-- \
  --collection /hdd1/home/soyuj/collection.tsv \
  --queries https://huggingface.co/datasets/macavaney/d2q-msmarco-passage \
  --scores https://huggingface.co/datasets/macavaney/d2q-msmarco-passage-scores-electra \
  --output /hdd1/home/soyuj/expanded_collection.tsv \
  --threshold 70 \
  --unique_terms_only
```